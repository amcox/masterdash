library("boot", lib.loc="C:/Program Files/R/R-3.1.0/library")
library("codetools", lib.loc="C:/Program Files/R/R-3.1.0/library")
library("compiler", lib.loc="C:/Program Files/R/R-3.1.0/library")
install.packages(c("boot", "codetools", "ggplot2"))
library("ggplot2", lib.loc="C:/Users/Sumeet/Documents/R/win-library/3.1")
setwd("~/GitHub/dci-tests/R")
library(tidyr)
update_functions <- function() {
old.wd <- getwd()
setwd("functions")
sapply(list.files(), source)
setwd(old.wd)
}
update_functions()
sapply(c('ela', 'math', 'sci', 'soc'), convert_eadms_for_subject)
setwd("~/GitHub/masterdash/csvs/scores")
library(stringr)
library(dplyr)
library(tidyr)
read_and_add_name <- function(filename) {
d <- read.csv(filename, head=TRUE, na.string=c('', ' '), stringsAsFactors=F)
d$test <- rep(str_extract(basename(filename), '\\w*'), nrow(d))
return(d)
}
load_all_from_raw <- function(dir=NULL) {
filenames <- list.files(paste0("./raw", dir), pattern=".csv", full.names=TRUE)
ldf <- lapply(filenames, read_and_add_name)
d <- rbind_all(ldf)
return(d)
}
cut_al <- function(vec) {
cut(vec, breaks=c(-999, 0.45, 0.5, 0.75, 0.9, 9999),
labels=c('U', 'AB', 'B', 'M', 'A'), right=F
)
}
cut_by_grade <- function(d) {
d$achievement_level <- cut_al(d$percent)
return(d)
}
ai.points <- data.frame(
achievement_level=c('A', 'M', 'B', 'AB', 'U', 'WTS', 'MS', 'ES', 'PF', 'F', 'AB2', 'B2'),
ai_points=c(150, 125, 100, 0, 0, 0, 100, 150, 0, 0, 100, 150)
)
# Load and process data from DCI tests
df <- load_all_from_raw()
d <- df %>% gather(subject, percent, ela:soc, na.rm=T)
d <- d %>% group_by(grade) %>% mutate(achievement_level=cut_al(percent))
d <- data.frame(d)
# d <- select(d, -grade)
d$scaled_score <- rep(NA, nrow(d))
# Load and process data from LEAP tests
dl <- read.csv('leap.csv', head=TRUE, na.string=c('', ' '), stringsAsFactors=F)
dl <- dl %>% gather(var, value, -student_number, na.rm=T)
dl <- dl %>% separate(var, c('subject', 'measure'), '\\.')
dl <- dl %>% spread(measure, value)
dl$test <- rep('L14', nrow(dl))
dl$percent <- rep(NA, nrow(dl))
# Put together and add columns
db <- rbind(d, dl)
db$year <- rep('2016', nrow(db))
db <- merge(db, ai.points)
db <- db %>% mutate(on_level = ai_points > 0)
# Save to a scores import file
write.csv(db, './../scores_import.csv', row.names=F, na='')
setwd("~/GitHub/masterdash/analysis/r")
# Makes two files for each test, facted by grade (or grade category) and
# subject, showing schools as bars.
library(dplyr)
library(gdata)
library(reshape2)
library(ggplot2)
library(scales)
library(gridExtra)
update_functions <- function() {
old.wd <- getwd()
setwd("functions")
sapply(list.files(), source)
setwd(old.wd)
}
update_functions()
multi_test_by_subjects_bar_plot_ai <- function(d, s) {
ggplot()+
geom_bar(data=d, aes(x=test_name, y=ai), fill="purple", stat="identity")+
geom_text(data=d, aes(label=round(ai, digits=0), x=test_name, y=ai + 7), size=2)+
scale_x_discrete(limits=test.order)+
scale_y_continuous(breaks=seq(0,150,20), limits=c(0,150))+
#		scale_fill_manual(values=alPalette.light.lows, guide=F)+
labs(title=paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores by Subject and Grade AI"),
x='Assessment',
y='Assessment Index'
)+
facet_grid(school ~ grade, labeller=short_labeller)+
theme_bw()+
theme(axis.text.x=element_text(size=5, angle=90, vjust=0.5),
axis.text.y=element_text(size=6)
)
}
con <- prepare_connection()
df <- create_student_school_scores_roll_up_ai(con)
df <- subset(df, school != "RSP")
df$school <- reorder(df$school, new.order=schools)
for (s in subjects.order){
df.s <- subset(df, subject == s & grade %in% plain.grades.nok2)
# d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(b_and_above(.))
p <- multi_test_by_subjects_bar_plot_ai(df.s, s)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores AI, 3-8 Single Grades"))
df.s <- subset(df, subject == s & grade %in% total.grades.nok2)
# d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(b_and_above(.))
p <- multi_test_by_subjects_bar_plot_ai(df.s, s)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores AI, 3-8 Small Schools"))
if(s != 'soc'){
df.s <- subset(df, subject == s & grade %in% k2.grades)
# d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(m_and_above(.))
p <- multi_test_by_subjects_bar_plot_ai(df.s, s) + scale_fill_manual(values=alPalette.light.lows.k2, guide=F)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores AI, PK-2"))
}
}
library(dplyr)
library(gdata)
library(reshape2)
library(ggplot2)
library(scales)
library(gridExtra)
update_functions <- function() {
old.wd <- getwd()
setwd("functions")
sapply(list.files(), source)
setwd(old.wd)
}
update_functions()
multi_test_by_subjects_bar_plot <- function(d, s) {
ggplot()+
geom_bar(data=d, aes(x=test_name, y=perc, fill=achievement.level), stat="identity")+
geom_text(data=d.cr, aes(label=round(perc.cr * 100, digits=0), x=test_name, y=perc.cr + .03), size=2)+
scale_x_discrete(limits=test.order)+
scale_y_continuous(labels=percent, breaks=seq(0,1,.1), limits=c(0,1.05))+
scale_fill_manual(values=alPalette.light.lows, guide=F)+
labs(title=paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores by Subject and Grade"),
x='Assessment',
y='Percent of Scores'
)+
facet_grid(school ~ grade, labeller=short_labeller)+
theme_bw()+
theme(axis.text.x=element_text(size=5, angle=90, vjust=0.5),
axis.text.y=element_text(size=6)
)
}
con <- prepare_connection()
df <- create_student_school_scores_roll_up(con)
#Excludes RSP
df <- subset(df, school != "RSP")
#Orders Schools
df$school <- reorder(df$school, new.order=schools)
for (s in subjects.order){
df.s <- subset(df, subject == s & grade %in% plain.grades.nok2 & achievement.level != 'U')
d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(b_and_above(.))
p <- multi_test_by_subjects_bar_plot(df.s, s)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores, 3-8 Single Grades"))
df.s <- subset(df, subject == s & grade %in% total.grades.nok2 & achievement.level != 'U')
d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(b_and_above(.))
p <- multi_test_by_subjects_bar_plot(df.s, s)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores, 3-8 Small Schools"))
if(s != 'soc'){
df.s <- subset(df, subject == s & grade %in% k2.grades & achievement.level != 'U')
d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(m_and_above(.))
p <- multi_test_by_subjects_bar_plot(df.s, s) + scale_fill_manual(values=alPalette.light.lows.k2, guide=F)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores, PK-2"))
}
}
# Makes two files for each test, facted by grade (or grade category) and
# subject, showing schools as bars.
library(dplyr)
library(gdata)
library(reshape2)
library(ggplot2)
library(scales)
library(gridExtra)
update_functions <- function() {
old.wd <- getwd()
setwd("functions")
sapply(list.files(), source)
setwd(old.wd)
}
update_functions()
multi_test_by_subjects_bar_plot_ai <- function(d, s) {
ggplot()+
geom_bar(data=d, aes(x=test_name, y=ai), fill="purple", stat="identity")+
geom_text(data=d, aes(label=round(ai, digits=0), x=test_name, y=ai + 7), size=2)+
scale_x_discrete(limits=test.order)+
scale_y_continuous(breaks=seq(0,150,20), limits=c(0,150))+
#		scale_fill_manual(values=alPalette.light.lows, guide=F)+
labs(title=paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores by Subject and Grade AI"),
x='Assessment',
y='Assessment Index'
)+
facet_grid(school ~ grade, labeller=short_labeller)+
theme_bw()+
theme(axis.text.x=element_text(size=5, angle=90, vjust=0.5),
axis.text.y=element_text(size=6)
)
}
con <- prepare_connection()
df <- create_student_school_scores_roll_up_ai(con)
df <- subset(df, school != "RSP")
df$school <- reorder(df$school, new.order=schools)
for (s in subjects.order){
df.s <- subset(df, subject == s & grade %in% plain.grades.nok2)
# d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(b_and_above(.))
p <- multi_test_by_subjects_bar_plot_ai(df.s, s)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores AI, 3-8 Single Grades"))
df.s <- subset(df, subject == s & grade %in% total.grades.nok2)
# d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(b_and_above(.))
p <- multi_test_by_subjects_bar_plot_ai(df.s, s)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores AI, 3-8 Small Schools"))
if(s != 'soc'){
df.s <- subset(df, subject == s & grade %in% k2.grades)
# d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(m_and_above(.))
p <- multi_test_by_subjects_bar_plot_ai(df.s, s) + scale_fill_manual(values=alPalette.light.lows.k2, guide=F)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores AI, PK-2"))
}
}
library(dplyr)
library(gdata)
library(reshape2)
library(ggplot2)
library(scales)
library(gridExtra)
update_functions <- function() {
old.wd <- getwd()
setwd("functions")
sapply(list.files(), source)
setwd(old.wd)
}
update_functions()
multi_test_by_subjects_bar_plot <- function(d, s) {
ggplot()+
geom_bar(data=d, aes(x=test_name, y=perc, fill=achievement.level), stat="identity")+
geom_text(data=d.cr, aes(label=round(perc.cr * 100, digits=0), x=test_name, y=perc.cr + .03), size=2)+
scale_x_discrete(limits=test.order)+
scale_y_continuous(labels=percent, breaks=seq(0,1,.1), limits=c(0,1.05))+
scale_fill_manual(values=alPalette.light.lows, guide=F)+
labs(title=paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores by Subject and Grade"),
x='Assessment',
y='Percent of Scores'
)+
facet_grid(school ~ grade, labeller=short_labeller)+
theme_bw()+
theme(axis.text.x=element_text(size=5, angle=90, vjust=0.5),
axis.text.y=element_text(size=6)
)
}
con <- prepare_connection()
df <- create_student_school_scores_roll_up(con)
#Excludes RSP
df <- subset(df, school != "RSP")
#Orders Schools
df$school <- reorder(df$school, new.order=schools)
for (s in subjects.order){
df.s <- subset(df, subject == s & grade %in% plain.grades.nok2 & achievement.level != 'U')
d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(b_and_above(.))
p <- multi_test_by_subjects_bar_plot(df.s, s)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores, 3-8 Single Grades"))
df.s <- subset(df, subject == s & grade %in% total.grades.nok2 & achievement.level != 'U')
d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(b_and_above(.))
p <- multi_test_by_subjects_bar_plot(df.s, s)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores, 3-8 Small Schools"))
if(s != 'soc'){
df.s <- subset(df, subject == s & grade %in% k2.grades & achievement.level != 'U')
d.cr <- df.s %>% group_by(school, grade, subject, test_name) %>% do(m_and_above(.))
p <- multi_test_by_subjects_bar_plot(df.s, s) + scale_fill_manual(values=alPalette.light.lows.k2, guide=F)
save_plot_as_pdf(p, paste0(long_labeller("subject", s), " 2015-16 Benchmark Scores, PK-2"))
}
}
